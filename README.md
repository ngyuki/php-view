# php view

プレーンな PHP のテンプレート。

- 自動エスケープ
- Smarty 風のテンプレート継承

## 継承の実装方法

output buffering (OB) を駆使してテンプレートのブロック構造を生成して、子のブロックで親のブロックを上書きしてレンダリングする。

子から `parent()` で親を呼び出すときがキモ、これがなければ親を遡ってレンダリングするだけで十分なのです。

理想的には、テンプレートのブロック構造の解析と、変数をアサインしてレンダリング、を別のフェーズにしたかったのだけど、ブロック構造の解析でテンプレートを PHP のコードとして実行する必要があるので、そのときに変数がアサインされていないとエラーになってしまう。

## テンプレートファイルから見えるインスタンス

テンプレートファイルから `$this` として参照できるインスタンスはアプリでメソッドを増やしたいので自前で用意できるようにした。

## 自動エスケープ

ストリームフィルタで無理やり実装。
